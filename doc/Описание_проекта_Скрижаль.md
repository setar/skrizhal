### Обобщение текущего состояния проекта протокола "Скрижаль"

Протокол "Скрижаль" — это транспортный протокол на основе криптоцепочки, предназначенный для обеспечения надёжной передачи данных и организации распределённого хранения. Основная задача заключается в защите целостности, конфиденциальности и аутентичности данных в сети, которая может включать в себя сотни или тысячи узлов. Основные аспекты проекта на текущий момент:

#### 1. **Архитектура сети**
- **Сеть распределённая**, с масштабируемостью от десятка до нескольких тысяч узлов.
- Узлы выполняют различные **роли**, включая: хранение полной или частичной криптоцепочки, контроллеры инфраструктуры, узлы хранения и т.д.
- В будущем роли узлов будут расширяться, и они будут выполнять также другие полезные функции, такие как базы данных или узлы виртуализации.
- **Добавление новых узлов** в сеть происходит через процедуру аттестации, что обеспечивает безопасность и контроль доступа.

#### 2. **Безопасность и управление доступом**
- Используется **CurveZMQ** вместо TLS для защиты соединений между узлами и шифрования передачи данных.
- Внедрена инфраструктура **PKI** для управления сертификатами узлов и подписей сообщений.
- Выпуск блоков в криптоцепочке основан на сочетании **PBFT (Practical Byzantine Fault Tolerance)** и **Proof-of-Authority (PoA)**, где определенные доверенные узлы создают новые блоки, которые затем подтверждаются через PBFT.

#### 3. **Криптоцепочка и консенсус**
- **Криптоцепочка** используется для фиксации изменений в сети. Каждый новый блок проходит проверку на целостность и легитимность перед добавлением в цепочку.
- **PBFT-консенсус** обеспечивает процесс согласования блоков, что минимизирует вероятность появления конфликтов и ошибок.
- В случае обнаружения ошибочного блока существует **автоматическая процедура отката**, чтобы предотвратить его добавление в цепочку.

#### 4. **Распределённое хранение данных**
- **Хранение крупных данных** осуществляется через систему **MinIO**. Данные хранятся в зашифрованном виде, и доступ к ним предоставляется после аттестации узлов.
- **Репликация данных** осуществляется на несколько узлов, чтобы обеспечить заданный уровень отказоустойчивости. Учёт "домена одной точки отказа" минимизирует риски потери данных.
- При записи данные сначала сохраняются на наименее загруженный узел, затем реплицируются на другие узлы для обеспечения отказоустойчивости.

#### 5. **Процедура аттестации и роли узлов**
- Новый узел проходит **аттестацию** у контроллеров инфраструктуры, чтобы получить роль и соответствующие права доступа.
- Узел получает доступ к **групповому ключу**, который позволяет ему взаимодействовать с базой данных ролей и шифрованными данными в MinIO.
- **Роли узлов** могут меняться, хотя это происходит редко. Все изменения фиксируются в криптоцепочке, что обеспечивает прозрачность.

#### 6. **Мониторинг и логирование**
- **Мониторинг** и **логирование** состояния узлов происходит через канал "ответов" криптоцепочки, используя инструменты **Prometheus** и **ELK Stack**.
- Эти инструменты работают как сервисы на узлах с ролью "мониторинг инфраструктуры" и используют данные из канала "ответов" для анализа и контроля состояния сети.

#### 7. **Маршрутизация данных в сети**
- Для **маршрутизации** используется механизм анонсирования идентификаторов "рабочих групп" через узлы, которые принадлежат нескольким группам или сетям.
- Информация о доступности рабочих групп протоколируется в основной базе данных конфигурации и обновляется только при изменении конфигурации сети.
- Синхронизация информации о доступности рабочих групп происходит автоматически по всей сети, обновляя базу данных конфигурации.

#### 8. **Отказоустойчивость и восстановление узлов**
- Узел считается потерянным, если к нему не ведет ни одного маршрута через цепь P2P туннелей в течение заданного временного интервала, который хранится в базе данных и является тюнингуемым параметром.
- При восстановлении утраченный узел должен пройти повторную **аттестацию** и синхронизировать свою криптоцепочку с узлом, который хранит полную цепочку.
- **Процедура репликации** утраченных данных запускается автоматически, если узел хранения выходит из строя, чтобы восстановить требуемый уровень реплик.

#### 9. **Обмен данными и приоритеты потоков**
- Обмен данными осуществляется асинхронно, с различной скоростью для командного потока и потока данных.
- Дополнительная приоритезация потоков не требуется, так как система спроектирована для минимизации задержек по естественным потокам обмена.
- Для координации передачи данных, аттестации и консенсуса используется **ZeroMQ**, что обеспечивает асинхронное и эффективное взаимодействие.

### Итог
Протокол "Скрижаль" представляет собой мощное решение для защищенной передачи данных, управления распределённым хранением и обеспечения безопасности сети. Мы внедрили криптоцепочку, инфраструктуру PKI, MinIO для хранения данных и процедуры аттестации, чтобы сделать сеть устойчивой, гибкой и безопасной. Следующими шагами будут дальнейшая проработка механизмов автоматизации аттестации узлов и настройка систем мониторинга, чтобы поддерживать высокий уровень производительности и отказоустойчивости.
